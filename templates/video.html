<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>VideoNation AI</title>

    <!-- Inlined professional styling (replaces external style.css) -->
    <style>
      :root{
        --bg-a: #0f1720;
        --accent-1: #4fbfb3;
        --accent-2: #74ebd5;
        --accent-3: #ff7d6e;
        --card-bg: rgba(255,255,255,0.94);
        --glass-bg: rgba(255,255,255,0.06);
        --muted: #6b7280;
        --shadow: 0 10px 30px rgba(2,6,23,0.45);
        --radius-lg: 14px;
      }

      /* Page */
      html,body {
        height: 100%;
        margin: 0;
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        -webkit-font-smoothing:antialiased;
        -moz-osx-font-smoothing:grayscale;
        background: linear-gradient(120deg, var(--accent-2) 0%, #ACB6E5 100%);
        color: #111827;
      }

      /* fixed navbar */
      .navbar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: #ffffffcc;
  backdrop-filter: blur(6px);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 28px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  z-index: 10;
}

.navbar .logo {
  font-weight: 700;
  font-size: 28px;
  color: #000;
  text-decoration: none;
  transition: color 0.3s ease;
}

.navbar .logo:hover {
  color: #3e3e3e;
}

      /* page container â€” offset because navbar is fixed */
      .container {
        max-width: 1024px;
        margin: 88px auto 48px;
        padding: 28px;
        border-radius: var(--radius-lg);
        background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.92));
        box-shadow: var(--shadow);
        display: block;
      }

      /* heading */
      .container h1 {
        margin: 0 0 12px 0;
        font-size: 22px;
        font-weight: 800;
        color: #0b1220;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      /* control row */
      .control-row {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-top: 14px;
        flex-wrap: wrap;
      }
      .control-row input[type="text"]{
        flex: 1 1 520px;
        min-width: 220px;
        padding: 12px 14px;
        border-radius: 10px;
        border: 1px solid rgba(11,18,32,0.06);
        background: #fff;
        box-shadow: 0 6px 18px rgba(11,18,32,0.04) inset;
        font-size: 15px;
        outline: none;
        transition: box-shadow .12s ease, border-color .12s ease;
      }
      .control-row input[type="text"]:focus{
        box-shadow: 0 12px 28px rgba(79,191,179,0.12);
        border-color: var(--accent-1);
      }

      .control-row button {
        padding: 10px 14px;
        border-radius: 10px;
        border: none;
        font-weight: 700;
        cursor: pointer;
        font-size: 14px;
        box-shadow: 0 8px 20px rgba(2,6,23,0.06);
      }
      #refineBtn{
        background: linear-gradient(90deg,var(--accent-3), #ffb86b);
        color: #fff;
      }
      #generateBtn{
        background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
        color: #fff;
      }

      /* selectors */
      .selector-block {
        display: flex;
        gap: 20px;
        margin-top: 18px;
        align-items: flex-start;
        flex-wrap: wrap;
      }
      .selector {
        flex: 1 1 320px;
        min-width: 200px;
      }
      .selector-title {
        font-weight: 800;
        font-size: 13px;
        color: #0b1220;
        margin-bottom: 8px;
      }
      .toggle-group {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      .toggle-btn {
        padding: 8px 12px;
        border-radius: 10px;
        border: 1px solid rgba(11,18,32,0.06);
        background: rgba(255,255,255,0.98);
        font-weight: 700;
        cursor: pointer;
        box-shadow: 0 6px 16px rgba(2,6,23,0.04);
        transition: transform .08s ease, background .12s ease, box-shadow .12s ease;
      }
      .toggle-btn:hover { transform: translateY(-3px); }
      .toggle-btn.active {
        background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
        color: white;
        border-color: transparent;
        box-shadow: 0 12px 30px rgba(79,191,179,0.12);
      }

      /* messages + output */
      #messages { margin-top: 14px; min-height: 20px; font-size: 14px; font-weight: 600; color: var(--muted); }
      #output { margin-top: 20px; }

      /* video styling â€” small default to keep page tidy */
      video {
        display: block;
        margin: 18px auto 0;
        border-radius: 10px;
        box-shadow: 0 12px 30px rgba(2,6,23,0.12);
        max-width: 100%;
        height: auto;
        transition: width .28s cubic-bezier(.2,.9,.2,1), transform .24s ease;
      }
      /* when JS sets .small class, keep it compact */
      video.small {
        width: min(540px, 86%);
        transform: scale(1);
      }
      /* large expanded video (browser created by removing 'small' class) will fill container nicely */
      video:not(.small) {
        width: 100%;
        max-width: 900px;
      }

      .download-link {
        display: inline-block;
        margin-top: 12px;
        text-decoration: none;
        background: linear-gradient(90deg,#6c6cf0,#4fbfb3);
        color: #fff;
        padding: 10px 16px;
        border-radius: 10px;
        font-weight: 700;
      }

      .error { color: #b00020; }
      .success { color: #0f8b6b; }

      /* responsive */
      @media (max-width: 880px) {
        .container { margin: 84px 18px; padding: 18px; }
        .control-row input[type="text"] { flex-basis: 100%; }
        .control-row { gap: 10px; }
        video.small { width: 100%; }
      }

      @media (max-width: 520px) {
        .navbar { padding: 12px 14px; height: 56px; }
        .navbar .logo { font-size: 18px; }
        .selector { flex-basis: 100%; }
      }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <a href="/" class="logo">VideoNation AI</a>
    </nav>

    <div class="container">
        <h1>ðŸŽ¬ VideoNation AI</h1>

        <div class="control-row">
            <input id="prompt" type="text" placeholder="Enter your prompt" required />
            <button type="button" id="refineBtn">Refine Prompt</button>
            <button id="generateBtn" type="button">Generate</button>
        </div>

        <div class="selector-block">
            <div class="selector">
                <div class="selector-title">Style</div>
                <div id="styleGroup" class="toggle-group">
                    <button class="toggle-btn" data-style="Cinematic">Cinematic</button>
                    <button class="toggle-btn" data-style="Ghibli">Ghibli</button>
                    <button class="toggle-btn" data-style="Animation">Animation</button>
                    <button class="toggle-btn" data-style="Sketch">Sketch</button>
                    <button class="toggle-btn" data-style="Fantasy">Fantasy</button>
                </div>
            </div>

            <div class="selector">
                <div class="selector-title">Aspect Ratio</div>
                <div id="aspectGroup" class="toggle-group">
                    <button class="toggle-btn" data-aspect="16:9">16:9</button>
                    <button class="toggle-btn" data-aspect="9:16">9:16</button>
                    <button class="toggle-btn" data-aspect="1:1">1:1</button>
                    <button class="toggle-btn" data-aspect="4:3">4:3</button>
                </div>
            </div>
        </div>

        <div id="messages" style="margin-top:10px;"></div>
        <div id="output"></div>
    </div>

    <!-- Inlined JS (your app.js content) -->
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const refineBtn = document.getElementById("refineBtn");
        const generateBtn = document.getElementById("generateBtn");

        if (refineBtn) refineBtn.addEventListener("click", refinePrompt);
        if (generateBtn) generateBtn.addEventListener("click", generateVideo);

        setupToggleGroups();
    });

    function setupToggleGroups() {
        const styleGroup = document.getElementById("styleGroup");
        const aspectGroup = document.getElementById("aspectGroup");

        if (styleGroup) {
            styleGroup.addEventListener("click", (e) => {
                const btn = e.target.closest(".toggle-btn");
                if (!btn) return;
                Array.from(styleGroup.querySelectorAll(".toggle-btn")).forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
            });
        }

        if (aspectGroup) {
            aspectGroup.addEventListener("click", (e) => {
                const btn = e.target.closest(".toggle-btn");
                if (!btn) return;
                Array.from(aspectGroup.querySelectorAll(".toggle-btn")).forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
            });
        }
    }

    function showMessage(msg, isError=false) {
        const el = document.getElementById("messages");
        if (!el) return;
        el.innerText = msg;
        el.className = isError ? "error" : "success";
    }

    function getSelectedStyle() {
        const active = document.querySelector("#styleGroup .toggle-btn.active");
        return active ? active.dataset.style : null;
    }

    function getSelectedAspect() {
        const active = document.querySelector("#aspectGroup .toggle-btn.active");
        return active ? active.dataset.aspect : null;
    }

    async function refinePrompt(event) {
        if (event && typeof event.preventDefault === "function") event.preventDefault();

        const promptEl = document.getElementById("prompt");
        const prompt = promptEl.value.trim();
        if (!prompt) {
            showMessage("Please enter a prompt to refine.", true);
            return;
        }

        const style = getSelectedStyle();
        const aspect = getSelectedAspect();

        showMessage("Refining prompt...");

        try {
            const res = await fetch('/refine', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt, style, aspect })
            });

            if (!res.ok) {
                const err = await res.json().catch(()=>({detail: res.statusText}));
                showMessage("Refine failed: " + (err.detail || res.statusText), true);
                return;
            }

            const data = await res.json();
            const refined = data.refined_prompt || data.original_prompt || prompt;
            promptEl.value = refined;
            showMessage("Prompt refined. Edit if needed and press Generate.");
        } catch (e) {
            showMessage("Refine request failed: " + (e.message || e), true);
        }
    }

    async function generateVideo(event) {
        if (event && typeof event.preventDefault === "function") event.preventDefault();

        const prompt = document.getElementById("prompt").value;
        if (!prompt || prompt.trim() === "") {
            showMessage("Please enter a prompt before generating.", true);
            return;
        }

        const style = getSelectedStyle();
        const aspect = getSelectedAspect();

        showMessage("Generating video...");

        try {
            const res = await fetch('/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt, style, aspect })
            });

            if (!res.ok) {
                const err = await res.json().catch(()=>({detail: res.statusText}));
                showMessage("Generate failed: " + (err.detail || res.statusText), true);
                return;
            }

            const data = await res.json();
            const videoUrl = data.video_url;
            document.getElementById("output").innerHTML = `
                <h3>Generated Video:</h3>
                <video id="generatedVideo" class="small" controls>
                    <source src="${videoUrl}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <br>
                <a class="download-link" href="${videoUrl}" download="generated.mp4">â¬‡ Download Video</a>
                <pre style="margin-top:8px;font-size:12px;color:#333;">Job ID: ${data.job_id || ''}</pre>
            `;

            // Expand on play
            const vid = document.getElementById("generatedVideo");
            vid.addEventListener("play", () => {
                vid.classList.remove("small");
            });

            showMessage(data.message || "Video ready.");
        } catch (e) {
            showMessage("Generate request failed: " + (e.message || e), true);
        }
    }
    </script>
</body>
</html>
